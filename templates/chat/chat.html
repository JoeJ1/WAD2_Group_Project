{% extends 'chat/chattemplates.html' %}
{% load staticfiles %}

{% block title_block %}
{{chat_name}}
{% endblock %}

{% block includes_block %}
{% endblock %}

{% block content_title %}
{{chat_name}}
{% if current_user == owner %}
<div class="btn-group float-right" role="group" aria-label="Chat Buttons">
    <a class="btn btn-primary" href="{% url 'chat:members' chat_name_slug %}">Members</a>
    <a class="btn btn-primary" href="{% url 'chat:files' chat_name_slug %}">Files</a>
    <a class="btn btn-primary" href="{% url 'chat:delete' chat_name_slug %}" onclick = "return confirm('Are you sure you want to delete?')">Delete Chat</a>
</div>
{% else %}
<div class="btn-group float-right" role="group" aria-label="Chat Buttons">
    <a class="btn btn-primary" href="{% url 'chat:members' chat_name_slug %}">Members</a>
    <a class="btn btn-primary" href="{% url 'chat:files' chat_name_slug %}">Files</a>
    <a class="btn btn-primary" href="{% url 'chat:leave' chat_name_slug %}" onclick = "return confirm('Are you sure you want to leave?')">Leave Chat</a>
</div>
{% endif %}
{% endblock %}
{% block body_block %}
{{ this_username|json_script:"this-username" }}
{{ chat_name_slug|json_script:"chat-slug" }}
<body>
    <div class="row row-tall h-100">
        <div class="col h-100">
            <div class="chat-message-list">
            {% for m in messages %}
                {% if m.sender.user.username == this_username %}
                <div class="message-container" style="display:flex; justify-content:end">
                    <div class="message" style="float:right">
                {% else %}
                <div class="message-container" style="display:flex; justify-content:start">
                    <div class="message" style="float:left">
                {% endif %}
                    {{m.sender.display_name}}: {{m.content}}
                    </div>
                </div>
            {% endfor %}
            </div>
            <div class="input-group mb-5 position-sticky">
              <input type="text" class="form-control" placeholder="Your message here" id="message-input">
              <button class="btn btn-outline-secondary" type="button" id="send-button">Send</button>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            $("#send-button").click(function() {
                let username = "{{this_username|escapejs}}";
                let slug = "{{chat_name_slug|escapejs}}";
                let content = $("#message-input").val();
                $.get('send_message',
                    {'content':content,'username':username,'chat_slug':slug},
                    function(data) {
                        alert(data)
                    })
            })
        });
    </script>
</body>
{% endblock %}
